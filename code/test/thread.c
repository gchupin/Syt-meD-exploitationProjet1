#include "syscall.h"

int SEM, mutex;

void putchar (void* ch)
{
  PutChar ((int)ch);
  V (SEM);
}

void getchar (void* ch)
{
  int c;
  c = GetChar ();
  P (mutex);
  PutString ("Caractère entré:");
  PutChar (c);
  PutChar ('\n');
  V (mutex);
  V(SEM);
}

void getstring (void* ch)
{
  int size = 1024;
  char s [size];
  GetString (s, size);
  P (mutex);
  PutString ("Chaine entré: ");
  PutString (s);
  V (mutex);
  V(SEM);
}

void putstring (void* string)
{
  PutString ((char*)string);
  V (SEM);
}

//You will have to enter some char 3 or 4 times.
int main ()
{
  //We can only have 4 thread running at the same time and there is already the main thread running
  SEM = SemCreate (3);
  //Mutex use when we want to print several things in the console.
  mutex = SemCreate (1);
  P (SEM);
  ThreadCreate (getstring, (void*)'g');
  P (SEM);
  ThreadCreate (putstring, (void*)"Première string\n");
  P (SEM);
  //Can mix with a putstring and do weird stuff
  ThreadCreate (putchar, (void*)'a');
  P (SEM);
  ThreadCreate (getstring, (void*)'g');
  P (SEM);
  //The getstring right after him will get the string withour the first char (so if we write 1 char, the nex getstring will have '\n'
  ThreadCreate (getchar, (void*)'g');
  P (SEM);
  ThreadCreate (putstring, (void*)"Deuxième string\n");
  P (SEM);
  ThreadCreate (getstring, (void*)'g');
  return 1;
}
